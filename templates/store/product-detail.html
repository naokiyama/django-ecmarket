{% extends "base.html" %}
{% load static %}
<body>
{% block content%}


<section class="section-content padding-y bg">
<div class="container">

<!-- ============================ COMPONENT 1 ================================= -->
<div class="card">
	<div class="row no-gutters">
		<aside class="col-md-6">
<article class="gallery-wrap"> 
	<div class="img-big-wrap">
	   <a href="#"><img src="{{ single_product.img.url }}"></a>
	</div> <!-- img-big-wrap.// -->
	
</article> <!-- gallery-wrap .end// -->
		</aside>
        <main class="col-md-6 border-left">
		<form method="POST" action="{% url 'cart:add_cart' single_product.id %}">
			{% csrf_token %}
			<article class="content-body">

			<h2 class="title">{{single_product.product_name}}</h2>
			<div class="rating-star">					
				{{ single_product.rating_average }}: 
				<i class="fa fa-star{% if single_product.rating_average < 0.5 %}-o{% elif single_product.rating_average >= 0.5 and single_product.rating_average < 1 %}-half-o{% endif %}" aria-hidden="true"></i>
				<i class="fa fa-star{% if single_product.rating_average < 1.5 %}-o{% elif single_product.rating_average >= 1.5 and single_product.rating_average < 2 %}-half-o{% endif %}" aria-hidden="true"></i>
				<i class="fa fa-star{% if single_product.rating_average < 2.5 %}-o{% elif single_product.rating_average >= 2.5 and single_product.rating_average < 3 %}-half-o{% endif %}" aria-hidden="true"></i>
				<i class="fa fa-star{% if single_product.rating_average < 3.5 %}-o{% elif single_product.rating_average >= 3.5 and single_product.rating_average < 4 %}-half-o{% endif %}" aria-hidden="true"></i>
				<i class="fa fa-star{% if single_product.rating_average < 4.5 %}-o{% elif single_product.rating_average >= 4.5 and single_product.rating_average < 5 %}-half-o{% endif %}" aria-hidden="true"></i>
			</div>
			<span>Number of reviews: {{ single_product.count_review }}</span>
			<br>
			<div class="mb-3"> 
				<var class="price h4">${{single_product.price}}</var> 
			</div> 

			<p>{{single_product.descritpion}}</p>

			<hr>

			<!--variationからproductにマッチしたsize,colorをfor文で表示-->
			<!--query文が助長な可能性があるため検討する必要性-->
				<div class="row">
					<div class="item-option-select">

					<!--Color選択欄表示-->
			        <!--カラー指定がなかったときに表示しない様にする処理未実装-->
					<h5>Select Color</h5>
					    <select name="color" class="form-control">
						<option value="color" disabled selected>Select</option>
						{% for variation in variations%}
						    {% if 'color' == variation.variation_choices%}
						        <option value="{{ variation.variation_value}}">{{ variation.variation_value}}</option>
						    {% endif %}
						{% endfor %}
						</select>

					<!--size選択欄表示-->
					<!--size指定がなかったときに表示しない様にする処理み実装-->
					<h5>Select Size</h5>
					    <select name="size" class="form-control">
						<option value="size" disabled selected>Select</option>
						{% for variation in variations%}
						    {% if 'size' == variation.variation_choices%}
						        <option value="{{ variation.variation_value }}">{{ variation.variation_value}}</option>
						    {% endif %}
						{% endfor %}
						</select>

					<!--condition指定がなかったときに表示しない様にする処理未実装-->
					{% if 'condition' in variation.variation_choices %}
					<h5>Select Condition</h5>
					    <select name="condition" class="form-control">
						<option value="condition" disabled selected>Select</option>
						{% for variation in variations%}
						    {% if 'condition' == variation.variation_choices%}
						        <option value="{{ variation.variation_value }}">{{ variation.variation_value}}</option>
						    {% endif %}
						{% endfor %}
						</select>
					{% endif %}
					</div>
			    </div>
				
				<hr>
				
				<!--在庫があるかどうかを判定-->
				{% if single_product.stock <= 0 %}
				<h5>Not Stock</h5>
				{% else %}
				<!--その商品を買い物かごに追加してあるかどうかで分岐-->
				<button type="submit" class="btn  btn-primary"> <span class="text">Add to cart</span> <i class="fas fa-shopping-cart"></i>  </button>
				{% endif %}
			</article> <!-- product-info-aside .// -->
		</form>
	</main> <!-- col.// -->

	</div> <!-- row.// -->
</div> <!-- card.// -->
<!-- ============================ COMPONENT 1 END .// ================================= -->

<br>

<div class="row">
			<div class="col-md-9">

	<header class="section-heading">
		
	</header>

	<form action="{% url 'store:submit_review' single_product.id %}" method="POST">
	{% csrf_token %}
	<h5>Write Your Review</h5>
	<div>
		<!--raiting stars-->
		<label>How do you rate this product?</label>
		<br>
		<div class="rate">
			<input type="radio" name="rating" id="rating10" value="5" required /><label for="rating10" title="5"></label>
			<input type="radio" name="rating" id="rating9" value="4.5" required /><label for="rating9" title="4.5" class="half"></label>
			<input type="radio" name="rating" id="rating8" value="4" required /><label for="rating8" title="4"></label>
			<input type="radio" name="rating" id="rating7" value="3.5" required /><label for="rating7" title="3.5" class="half"></label>
			<input type="radio" name="rating" id="rating6" value="3" required /><label for="rating6" title="3"></label>
			<input type="radio" name="rating" id="rating5" value="2.5" required /><label for="rating5" title="2.5" class="half"></label>
			<input type="radio" name="rating" id="rating4" value="2" required /><label for="rating4" title="2"></label>
			<input type="radio" name="rating" id="rating3" value="1.5" required /><label for="rating3" title="1.5" class="half"></label>
			<input type="radio" name="rating" id="rating2" value="1" required /><label for="rating2" title="1"></label>
			<input type="radio" name="rating" id="rating1" value="0.5" required /><label for="rating1" title="0.5" class="half"></label>
		</div>
		<br>
		Review Title:
		<input type="text" class="form-control" name="subject">
		<br>
		Review Title:
		<textarea name="review" rows="4" class="form-control"></textarea>
		<br>
		{% if user.is_authenticated %}
			{% if orderproduct %}
				<input type="submit" value="Submit Review" class="btn btn-primary">
			{% else %}
			You need to purchase this product to post a review 
			{% endif %}
		{% else %}
			You need to loggin in to post a review: <span><a href="{% url 'accounts:login' %}">Log In</a></span>
		{% endif %}

	</div>
    </form>   
	<br>
	<h3>Customer Reviews </h3>
	<h4>Average Review</h4>
	
	<div class="rating-star">		
		{{ single_product.rating_average }}: 			
		<i class="fa fa-star{% if single_product.rating_average < 0.5 %}-o{% elif single_product.rating_average >= 0.5 and single_product.rating_average < 1 %}-half-o{% endif %}" aria-hidden="true"></i>
		<i class="fa fa-star{% if single_product.rating_average < 1.5 %}-o{% elif single_product.rating_average >= 1.5 and single_product.rating_average < 2 %}-half-o{% endif %}" aria-hidden="true"></i>
		<i class="fa fa-star{% if single_product.rating_average < 2.5 %}-o{% elif single_product.rating_average >= 2.5 and single_product.rating_average < 3 %}-half-o{% endif %}" aria-hidden="true"></i>
		<i class="fa fa-star{% if single_product.rating_average < 3.5 %}-o{% elif single_product.rating_average >= 3.5 and single_product.rating_average < 4 %}-half-o{% endif %}" aria-hidden="true"></i>
		<i class="fa fa-star{% if single_product.rating_average < 4.5 %}-o{% elif single_product.rating_average >= 4.5 and single_product.rating_average < 5 %}-half-o{% endif %}" aria-hidden="true"></i>
	</div>
	
	<br/>
	{% for review in review_rating %}
	<article class="box mb-3">
		<div class="icontext w-100">
			<div classs="text">
				<span class="date text-muted float-md-right">{{ review.created_at }}</span>  
				<h6 class="mb-1">{{ review.user.full_name }}</h6>
				<span>Rate: </span>
				<div class="rating-star">
						<i class="fa fa-star{% if review.rating == 0.5 %}-half-0{% elif review.rating < 1 %}-o{% endif %}" aria-hidden="true"></i>
						<i class="fa fa-star{% if review.rating == 0.5 %}-half-0{% elif review.rating < 2 %}-o{% endif %}" aria-hidden="true"></i>
						<i class="fa fa-star{% if review.rating == 0.5 %}-half-0{% elif review.rating < 3 %}-o{% endif %}" aria-hidden="true"></i>
						<i class="fa fa-star{% if review.rating == 0.5 %}-half-0{% elif review.rating < 4 %}-o{% endif %}" aria-hidden="true"></i>
						<i class="fa fa-star{% if review.rating == 0.5 %}-half-0{% elif review.rating < 5 %}-o{% endif %}" aria-hidden="true"></i>
					</span>
				</div>
			</div>
		</div> <!-- icontext.// -->
		    
		<div class="mt-3">
			<p>
				{{ review.review}}
			</p>	
		</div>
		
	</article>

	{% endfor %}

	</div> <!-- col.// -->
</div> <!-- row.// -->


</div> <!-- container .//  -->
</section>
<!-- ========================= SECTION CONTENT END// ========================= -->
{% endblock %}
</body>
</html>
